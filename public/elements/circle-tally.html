<!--
  `<circle-tally>` includes a tally control in the page

  @copyright Bill Robitske, Jr. 2017
  @author Bill Robitske, Jr. <bill.robitske.jr@gmail.com>
  @license MIT
-->
<dom-module id="circle-tally">
  <template strip-whitespace>
    <style>
      :host {
        display: inline-block;
        color: var(--circle-tally-color, rgb(0, 0, 39));
        cursor: pointer;
      }
      .c-circle::before {
        content: "⚪";
      }
      .c-circle.is-filled::before {
        content: "⚫";
      }
      :host:hover .c-circle:first-child:not(.is-filled),
      :host:hover .c-circle.is-filled + .c-circle:not(.is-filled),
      :host:hover .c-circle.is-filled + .c-tally-add {
        text-shadow: 0 0 4px var(--circle-tally-hover-color, rgba(0, 0, 39, 0.5)), 0 0 2px var(--circle-tally-hover-color, rgba(0, 0, 39, 0.5));
      }
      .c-tally-add {
        display: inline-block;
        width: 1.65em;
        text-align: right;
      }
      .c-tally-add:empty {
        opacity: 0.5;
      }
      .c-tally-add::before {
        content: "+";
      }
      .c-tally-add:empty::after {
        content: "00";
      }
    </style>
    <span class$="c-circle [[_generateIsFilledClass(value, 1)]]"></span>
    <span class$="c-circle [[_generateIsFilledClass(value, 2)]]"></span>
    <span class$="c-circle [[_generateIsFilledClass(value, 3)]]"></span>
    <span class$="c-circle [[_generateIsFilledClass(value, 4)]]"></span>
    <span class$="c-circle [[_generateIsFilledClass(value, 5)]]"></span>
    <span class="c-tally-add">[[_generateAdditionalTally(value)]]</span>
  </template>
  <script>
    Polymer({
      is: 'circle-tally',
      properties: {

        /**
         * Current tally count
         */
        value: {
          type: Number,
          value: 0,
          notify: true
        }
      },

      listeners: {
        'tap': '_tally'
      },

      /**
       * @event circle-tally-increment
       * @param {Number} value Current tally count
       */

      /**
       * Generates the `is-filled` class for a circle if needed
       *
       * @private
       * @param {Number} tallyValue Current tally count
       * @param {Number} circleValue Tally count of the circle
       * @returns {String} `is-filled` class or blank
       */
      _generateIsFilledClass: function(tallyValue, circleValue) {
        return tallyValue >= circleValue ? 'is-filled' : '';
      },

      /**
       * Generates the additional tally count value if needed
       *
       * @private
       * @param {Number} tallyValue Current tally count
       * @returns {Number?} The number of tallies over 5, or null
       */
      _generateAdditionalTally: function(tallyValue) {
        return tallyValue > 5 ? tallyValue - 5 : null;
      },

      /**
       * Increments this tally count
       *
       * @private
       * @fires circle-tally-increment
       */
      _tally: function() {
        this.set('value', parseInt(this.value) + 1);
        this.fire('circle-tally-increment', { value: this.value });
      }
    });
  </script>
</dom-module>
